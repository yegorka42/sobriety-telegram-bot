import os
import telebot
from datetime import datetime, timedelta
import json

# –ü–æ–ª—É—á–∞–µ–º —Ç–æ–∫–µ–Ω –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è
BOT_TOKEN = os.getenv('BOT_TOKEN')

if not BOT_TOKEN:
    print("–û—à–∏–±–∫–∞: BOT_TOKEN –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è")
    exit(1)

bot = telebot.TeleBot(BOT_TOKEN)

# –°–ª–æ–≤–∞—Ä—å –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (–≤ —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–æ–µ–∫—Ç–µ –ª—É—á—à–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö)
user_data = {}

def save_user_data():
    """–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (–≤ —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–æ–µ–∫—Ç–µ - –≤ –ë–î)"""
    try:
        with open('user_data.json', 'w', encoding='utf-8') as f:
            # –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º datetime –≤ —Å—Ç—Ä–æ–∫–∏ –¥–ª—è JSON
            data_to_save = {}
            for user_id, data in user_data.items():
                data_to_save[user_id] = data.copy()
                if 'sobriety_start' in data_to_save[user_id]:
                    data_to_save[user_id]['sobriety_start'] = data_to_save[user_id]['sobriety_start'].isoformat()
            json.dump(data_to_save, f, ensure_ascii=False, indent=2)
    except Exception as e:
        print(f"–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö: {e}")

def load_user_data():
    """–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π"""
    global user_data
    try:
        with open('user_data.json', 'r', encoding='utf-8') as f:
            loaded_data = json.load(f)
            # –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º —Å—Ç—Ä–æ–∫–∏ –æ–±—Ä–∞—Ç–Ω–æ –≤ datetime
            for user_id, data in loaded_data.items():
                if 'sobriety_start' in data:
                    data['sobriety_start'] = datetime.fromisoformat(data['sobriety_start'])
                user_data[user_id] = data
    except FileNotFoundError:
        user_data = {}
    except Exception as e:
        print(f"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö: {e}")
        user_data = {}

def get_sobriety_days(user_id):
    """–ü–æ–ª—É—á–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–Ω–µ–π —Ç—Ä–µ–∑–≤–æ—Å—Ç–∏"""
    if user_id not in user_data or 'sobriety_start' not in user_data[user_id]:
        return 0
    
    start_date = user_data[user_id]['sobriety_start']
    return (datetime.now() - start_date).days

def format_sobriety_message(days):
    """–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ —Ç—Ä–µ–∑–≤–æ—Å—Ç–∏"""
    if days == 0:
        return "üéØ –°–µ–≥–æ–¥–Ω—è –≤–∞—à –ø–µ—Ä–≤—ã–π –¥–µ–Ω—å! –í—ã –º–æ–∂–µ—Ç–µ —ç—Ç–æ —Å–¥–µ–ª–∞—Ç—å!"
    elif days == 1:
        return "üåü –ü–æ–∑–¥—Ä–∞–≤–ª—è—é! –£ –≤–∞—Å 1 –¥–µ–Ω—å —Ç—Ä–µ–∑–≤–æ—Å—Ç–∏!"
    elif days < 7:
        return f"üí™ –û—Ç–ª–∏—á–Ω–æ! –£ –≤–∞—Å {days} –¥–Ω–µ–π —Ç—Ä–µ–∑–≤–æ—Å—Ç–∏!"
    elif days < 30:
        weeks = days // 7
        remaining_days = days % 7
        if remaining_days == 0:
            return f"üèÜ –ü—Ä–µ–≤–æ—Å—Ö–æ–¥–Ω–æ! –£ –≤–∞—Å {weeks} –Ω–µ–¥–µ–ª—å{'–∞' if weeks < 5 else ''} —Ç—Ä–µ–∑–≤–æ—Å—Ç–∏!"
        else:
            return f"üèÜ –ü—Ä–µ–≤–æ—Å—Ö–æ–¥–Ω–æ! –£ –≤–∞—Å {weeks} –Ω–µ–¥–µ–ª—å{'–∞' if weeks < 5 else ''} –∏ {remaining_days} –¥–Ω–µ–π —Ç—Ä–µ–∑–≤–æ—Å—Ç–∏!"
    elif days < 365:
        months = days // 30
        remaining_days = days % 30
        if remaining_days == 0:
            return f"üéä –ù–µ–≤–µ—Ä–æ—è—Ç–Ω–æ! –£ –≤–∞—Å {months} –º–µ—Å—è—Ü{'–∞' if months < 5 else '–µ–≤'} —Ç—Ä–µ–∑–≤–æ—Å—Ç–∏!"
        else:
            return f"üéä –ù–µ–≤–µ—Ä–æ—è—Ç–Ω–æ! –£ –≤–∞—Å {months} –º–µ—Å—è—Ü{'–∞' if months < 5 else '–µ–≤'} –∏ {remaining_days} –¥–Ω–µ–π —Ç—Ä–µ–∑–≤–æ—Å—Ç–∏!"
    else:
        years = days // 365
        remaining_days = days % 365
        return f"üèÖ –õ–µ–≥–µ–Ω–¥–∞! –£ –≤–∞—Å {years} –≥–æ–¥{'–∞' if years < 5 else ''} –∏ {remaining_days} –¥–Ω–µ–π —Ç—Ä–µ–∑–≤–æ—Å—Ç–∏!"

@bot.message_handler(commands=['start'])
def start_command(message):
    user_id = str(message.from_user.id)
    username = message.from_user.first_name or "–î—Ä—É–≥"
    
    welcome_text = f"""
üåü –ü—Ä–∏–≤–µ—Ç, {username}! 

–Ø –±–æ—Ç –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ —Ç—Ä–µ–∑–≤–æ—Å—Ç–∏. –í–º–µ—Å—Ç–µ –º—ã —Å–º–æ–∂–µ–º –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –≤–∞—à –ø—Ä–æ–≥—Ä–µ—Å—Å –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å –º–æ—Ç–∏–≤–∞—Ü–∏—é!

üìã –î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:
/start - –Ω–∞—á–∞—Ç—å —Ä–∞–±–æ—Ç—É —Å –±–æ—Ç–æ–º
/setdate - —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –¥–∞—Ç—É –Ω–∞—á–∞–ª–∞ —Ç—Ä–µ–∑–≤–æ—Å—Ç–∏
/status - —É–∑–Ω–∞—Ç—å —Ç–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å
/motivation - –ø–æ–ª—É—á–∏—Ç—å –º–æ—Ç–∏–≤–∞—Ü–∏–æ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
/tips - –ø–æ–ª–µ–∑–Ω—ã–µ —Å–æ–≤–µ—Ç—ã
/help - –ø–æ–º–æ—â—å

üí™ –ö–∞–∂–¥—ã–π –¥–µ–Ω—å —Ç—Ä–µ–∑–≤–æ—Å—Ç–∏ - —ç—Ç–æ –ø–æ–±–µ–¥–∞! –î–∞–≤–∞–π—Ç–µ –Ω–∞—á–Ω–µ–º –≤–∞—à –ø—É—Ç—å –∫ –∑–¥–æ—Ä–æ–≤–æ–π –∂–∏–∑–Ω–∏.
"""
    
    bot.send_message(message.chat.id, welcome_text)

@bot.message_handler(commands=['setdate'])
def set_date_command(message):
    user_id = str(message.from_user.id)
    
    # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–µ–≥–æ–¥–Ω—è—à–Ω—é—é –¥–∞—Ç—É –∫–∞–∫ –Ω–∞—á–∞–ª–æ —Ç—Ä–µ–∑–≤–æ—Å—Ç–∏
    if user_id not in user_data:
        user_data[user_id] = {}
    
    user_data[user_id]['sobriety_start'] = datetime.now()
    save_user_data()
    
    response = """
üéØ –û—Ç–ª–∏—á–Ω–æ! –°–µ–≥–æ–¥–Ω—è –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –≤–∞—à –ø—É—Ç—å –∫ —Ç—Ä–µ–∑–≤–æ—Å—Ç–∏!

üìÖ –î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞: —Å–µ–≥–æ–¥–Ω—è
üå± –ö–∞–∂–¥—ã–π –¥–µ–Ω—å –±—É–¥–µ—Ç —Å—á–∏—Ç–∞—Ç—å—Å—è –∫–∞–∫ –Ω–æ–≤–∞—è –ø–æ–±–µ–¥–∞!

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ /status —á—Ç–æ–±—ã –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–≤–æ–π –ø—Ä–æ–≥—Ä–µ—Å—Å.
üí™ –í—ã –º–æ–∂–µ—Ç–µ —ç—Ç–æ —Å–¥–µ–ª–∞—Ç—å!
"""
    
    bot.send_message(message.chat.id, response)

@bot.message_handler(commands=['status'])
def status_command(message):
    user_id = str(message.from_user.id)
    
    if user_id not in user_data or 'sobriety_start' not in user_data[user_id]:
        bot.send_message(message.chat.id, 
                        "üìã –°–Ω–∞—á–∞–ª–∞ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –¥–∞—Ç—É –Ω–∞—á–∞–ª–∞ —Ç—Ä–µ–∑–≤–æ—Å—Ç–∏ –∫–æ–º–∞–Ω–¥–æ–π /setdate")
        return
    
    days = get_sobriety_days(user_id)
    status_message = format_sobriety_message(days)
    
    # –î–æ–±–∞–≤–ª—è–µ–º –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
    start_date = user_data[user_id]['sobriety_start'].strftime("%d.%m.%Y")
    
    full_message = f"""
{status_message}

üìÖ –î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞: {start_date}
üìä –í—Å–µ–≥–æ –¥–Ω–µ–π: {days}

{get_milestone_message(days)}
"""
    
    bot.send_message(message.chat.id, full_message)

def get_milestone_message(days):
    """–ü–æ–ª—É—á–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ –≤–µ—Ö–∏"""
    if days == 7:
        return "üéâ –ü–æ–∑–¥—Ä–∞–≤–ª—è—é —Å –ø–µ—Ä–≤–æ–π –Ω–µ–¥–µ–ª–µ–π! –≠—Ç–æ –≤–∞–∂–Ω–∞—è –≤–µ—Ö–∞!"
    elif days == 30:
        return "üéä –ú–µ—Å—è—Ü —Ç—Ä–µ–∑–≤–æ—Å—Ç–∏! –í—ã –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –ø—É—Ç–∏!"
    elif days == 90:
        return "üèÜ –¢—Ä–∏ –º–µ—Å—è—Ü–∞! –í–∞—à–∞ —Å–∏–ª–∞ –≤–æ–ª–∏ –≤–ø–µ—á–∞—Ç–ª—è–µ—Ç!"
    elif days == 365:
        return "üèÖ –ì–û–î –¢–†–ï–ó–í–û–°–¢–ò! –í—ã –Ω–∞—Å—Ç–æ—è—â–∏–π –≥–µ—Ä–æ–π!"
    elif days % 100 == 0 and days > 0:
        return f"üåü {days} –¥–Ω–µ–π - –∫—Ä—É–≥–ª–∞—è –¥–∞—Ç–∞! –ü—Ä–æ–¥–æ–ª–∂–∞–π—Ç–µ –≤ —Ç–æ–º –∂–µ –¥—É—Ö–µ!"
    else:
        return "üí™ –ü—Ä–æ–¥–æ–ª–∂–∞–π—Ç–µ –¥–≤–∏–≥–∞—Ç—å—Å—è –≤–ø–µ—Ä–µ–¥! –ö–∞–∂–¥—ã–π –¥–µ–Ω—å –≤–∞–∂–µ–Ω!"

@bot.message_handler(commands=['motivation'])
def motivation_command(message):
    motivational_quotes = [
        "üí™ '–¢—Ä–µ–∑–≤–æ—Å—Ç—å - —ç—Ç–æ –Ω–µ –ª–∏—à–µ–Ω–∏–µ —Å–µ–±—è —á–µ–≥–æ-—Ç–æ, –∞ –æ–±—Ä–µ—Ç–µ–Ω–∏–µ –≤—Å–µ–≥–æ.' - –ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –∞–≤—Ç–æ—Ä",
        "üåü '–ö–∞–∂–¥—ã–π –¥–µ–Ω—å —Ç—Ä–µ–∑–≤–æ—Å—Ç–∏ - —ç—Ç–æ –¥–µ–Ω—å, –∫–æ–≥–¥–∞ –≤—ã –≤—ã–±–∏—Ä–∞–µ—Ç–µ —Å–µ–±—è.' - –ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –∞–≤—Ç–æ—Ä",
        "üèÜ '–°–∏–ª—å–Ω—ã–µ –ª—é–¥–∏ –Ω–µ –∏–∑–±–µ–≥–∞—é—Ç —Ç—Ä—É–¥–Ω–æ—Å—Ç–µ–π, –æ–Ω–∏ –∏—Ö –ø—Ä–µ–æ–¥–æ–ª–µ–≤–∞—é—Ç.'",
        "üå± '–ò–∑–º–µ–Ω–µ–Ω–∏—è –Ω–∞—á–∏–Ω–∞—é—Ç—Å—è —Å –æ–¥–Ω–æ–≥–æ —Ä–µ—à–µ–Ω–∏—è, –ø—Ä–∏–Ω—è—Ç–æ–≥–æ –≤ –æ–¥–∏–Ω –º–æ–º–µ–Ω—Ç.'",
        "‚≠ê '–í—ã —Å–∏–ª—å–Ω–µ–µ, —á–µ–º –¥—É–º–∞–µ—Ç–µ, –∏ —Å–ø–æ—Å–æ–±–Ω—ã –Ω–∞ –±–æ–ª—å—à–µ–µ, —á–µ–º –º–æ–∂–µ—Ç–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç—å.'",
        "üéØ '–ö–∞–∂–¥—ã–π –Ω–æ–≤—ã–π –¥–µ–Ω—å - —ç—Ç–æ –Ω–æ–≤–∞—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Å—Ç–∞—Ç—å –ª—É—á—à–µ.'",
        "üíé '–í–∞—à–∞ –∂–∏–∑–Ω—å —Å—Ç–æ–∏—Ç –≤—Å–µ—Ö —É—Å–∏–ª–∏–π, –∫–æ—Ç–æ—Ä—ã–µ –≤—ã –≤ –Ω–µ—ë –≤–∫–ª–∞–¥—ã–≤–∞–µ—Ç–µ.'",
        "üöÄ '–¢—Ä–µ–∑–≤–æ—Å—Ç—å - —ç—Ç–æ —Å–≤–æ–±–æ–¥–∞ –±—ã—Ç—å —Å–æ–±–æ–π –±–µ–∑ –∏—Å–∫–∞–∂–µ–Ω–∏–π.'"
    ]
    
    import random
    quote = random.choice(motivational_quotes)
    
    bot.send_message(message.chat.id, f"üåà –ú–æ—Ç–∏–≤–∞—Ü–∏—è –¥–Ω—è:\n\n{quote}")

@bot.message_handler(commands=['tips'])
def tips_command(message):
    tips = """
üí° –ü–æ–ª–µ–∑–Ω—ã–µ —Å–æ–≤–µ—Ç—ã –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∞–Ω–∏—è —Ç—Ä–µ–∑–≤–æ—Å—Ç–∏:

üèÉ‚Äç‚ôÇÔ∏è –§–∏–∑–∏—á–µ—Å–∫–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å:
‚Ä¢ –†–µ–≥—É–ª—è—Ä–Ω—ã–µ –ø—Ä–æ–≥—É–ª–∫–∏ –Ω–∞ —Å–≤–µ–∂–µ–º –≤–æ–∑–¥—É—Ö–µ
‚Ä¢ –ó–∞–Ω—è—Ç–∏—è —Å–ø–æ—Ä—Ç–æ–º –∏–ª–∏ –π–æ–≥–æ–π
‚Ä¢ –î—ã—Ö–∞—Ç–µ–ª—å–Ω—ã–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è

üß† –ú–µ–Ω—Ç–∞–ª—å–Ω–æ–µ –∑–¥–æ—Ä–æ–≤—å–µ:
‚Ä¢ –ú–µ–¥–∏—Ç–∞—Ü–∏—è –∏ –æ—Å–æ–∑–Ω–∞–Ω–Ω–æ—Å—Ç—å
‚Ä¢ –í–µ–¥–µ–Ω–∏–µ –¥–Ω–µ–≤–Ω–∏–∫–∞ —ç–º–æ—Ü–∏–π
‚Ä¢ –ò–∑—É—á–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –Ω–∞–≤—ã–∫–æ–≤

üë• –°–æ—Ü–∏–∞–ª—å–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞:
‚Ä¢ –û–±—â–µ–Ω–∏–µ —Å –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—â–∏–º–∏ –ª—é–¥—å–º–∏
‚Ä¢ –£—á–∞—Å—Ç–∏–µ –≤ –≥—Ä—É–ø–ø–∞—Ö –ø–æ–¥–¥–µ—Ä–∂–∫–∏
‚Ä¢ –ò–∑–±–µ–≥–∞–Ω–∏–µ —Ç—Ä–∏–≥–≥–µ—Ä–Ω—ã—Ö —Å–∏—Ç—É–∞—Ü–∏–π

üéØ –¶–µ–ª–∏ –∏ —Ö–æ–±–±–∏:
‚Ä¢ –ü–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–æ–≤—ã—Ö —Ü–µ–ª–µ–π
‚Ä¢ –†–∞–∑–≤–∏—Ç–∏–µ —Ç–≤–æ—Ä—á–µ—Å–∫–∏—Ö —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–µ–π
‚Ä¢ –í–æ–ª–æ–Ω—Ç–µ—Ä—Å—Ç–≤–æ –∏ –ø–æ–º–æ—â—å –¥—Ä—É–≥–∏–º

üí§ –ó–¥–æ—Ä–æ–≤—ã–π –æ–±—Ä–∞–∑ –∂–∏–∑–Ω–∏:
‚Ä¢ –†–µ–≥—É–ª—è—Ä–Ω—ã–π —Å–æ–Ω (7-9 —á–∞—Å–æ–≤)
‚Ä¢ –ó–¥–æ—Ä–æ–≤–æ–µ –ø–∏—Ç–∞–Ω–∏–µ
‚Ä¢ –î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–æ–¥—ã

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ /motivation –¥–ª—è –µ–∂–µ–¥–Ω–µ–≤–Ω–æ–π –ø–æ–¥–¥–µ—Ä–∂–∫–∏! üí™
"""
    
    bot.send_message(message.chat.id, tips)

@bot.message_handler(commands=['help'])
def help_command(message):
    help_text = """
ü§ñ –ü–æ–º–æ—â—å –ø–æ –∫–æ–º–∞–Ω–¥–∞–º –±–æ—Ç–∞:

/start - –∑–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞ –∏ –ø–æ–ª—É—á–∏—Ç—å –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ
/setdate - —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–µ–≥–æ–¥–Ω—è –∫–∞–∫ –Ω–∞—á–∞–ª–æ —Ç—Ä–µ–∑–≤–æ—Å—Ç–∏
/status - —É–∑–Ω–∞—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–Ω–µ–π —Ç—Ä–µ–∑–≤–æ—Å—Ç–∏
/motivation - –ø–æ–ª—É—á–∏—Ç—å –º–æ—Ç–∏–≤–∞—Ü–∏–æ–Ω–Ω—É—é —Ü–∏—Ç–∞—Ç—É
/tips - –ø–æ–ª–µ–∑–Ω—ã–µ —Å–æ–≤–µ—Ç—ã –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∞–Ω–∏—è —Ç—Ä–µ–∑–≤–æ—Å—Ç–∏
/help - –ø–æ–∫–∞–∑–∞—Ç—å —ç—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏–µ

üìù –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–æ—Ç–∞:
1. –ù–∞—á–Ω–∏—Ç–µ —Å –∫–æ–º–∞–Ω–¥—ã /setdate
2. –ö–∞–∂–¥—ã–π –¥–µ–Ω—å –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ /status
3. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ /motivation –∫–æ–≥–¥–∞ –Ω—É–∂–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞
4. –ß–∏—Ç–∞–π—Ç–µ /tips –¥–ª—è –ø–æ–ª–µ–∑–Ω—ã—Ö —Å–æ–≤–µ—Ç–æ–≤

üí¨ –¢–∞–∫–∂–µ –≤—ã –º–æ–∂–µ—Ç–µ –ø—Ä–æ—Å—Ç–æ –ø–∏—Å–∞—Ç—å –º–Ω–µ —Å–æ–æ–±—â–µ–Ω–∏—è - —è –æ—Ç–≤–µ—á—É —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π!

üÜò –ï—Å–ª–∏ –Ω—É–∂–Ω–∞ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–∞—è –ø–æ–º–æ—â—å, –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞–º –ø–æ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º.
"""
    
    bot.send_message(message.chat.id, help_text)

@bot.message_handler(func=lambda message: True)
def handle_all_messages(message):
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Å–µ—Ö –æ—Å—Ç–∞–ª—å–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π"""
    user_id = str(message.from_user.id)
    
    # –ü—Ä–æ—Å—Ç—ã–µ –æ—Ç–≤–µ—Ç—ã –Ω–∞ –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞
    text = message.text.lower()
    
    if any(word in text for word in ['–ø–æ–º–æ—â—å', '–ø–ª–æ—Ö–æ', '—Ç—è–∂–µ–ª–æ', '—Å—Ä—ã–≤', '—Ö–æ—á—É –≤—ã–ø–∏—Ç—å']):
        response = """
ü§ó –Ø –ø–æ–Ω–∏–º–∞—é, —á—Ç–æ —Å–µ–π—á–∞—Å –º–æ–∂–µ—Ç –±—ã—Ç—å —Ç—Ä—É–¥–Ω–æ. –ü–æ–º–Ω–∏—Ç–µ:

üí™ –í—ã —É–∂–µ –ø—Ä–æ–¥–µ–ª–∞–ª–∏ –æ–≥—Ä–æ–º–Ω—É—é —Ä–∞–±–æ—Ç—É
üåü –ö–∞–∂–¥—ã–π –º–æ–º–µ–Ω—Ç —Ç—Ä–µ–∑–≤–æ—Å—Ç–∏ —Ü–µ–Ω–µ–Ω
üéØ –≠—Ç–∏ —á—É–≤—Å—Ç–≤–∞ –≤—Ä–µ–º–µ–Ω–Ω—ã –∏ –ø—Ä–æ–π–¥—É—Ç

–ü–æ–ø—Ä–æ–±—É–π—Ç–µ:
‚Ä¢ –ì–ª—É–±–æ–∫–æ –ø–æ–¥—ã—à–∞—Ç—å 5 –º–∏–Ω—É—Ç
‚Ä¢ –í—ã–ø–∏—Ç—å —Å—Ç–∞–∫–∞–Ω –≤–æ–¥—ã
‚Ä¢ –ü–æ–∑–≤–æ–Ω–∏—Ç—å –¥—Ä—É–≥—É –∏–ª–∏ –±–ª–∏–∑–∫–æ–º—É
‚Ä¢ –°–¥–µ–ª–∞—Ç—å –Ω–µ–±–æ–ª—å—à—É—é –ø—Ä–æ–≥—É–ª–∫—É

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ /motivation –¥–ª—è –≤–¥–æ—Ö–Ω–æ–≤–µ–Ω–∏—è –∏–ª–∏ /tips –¥–ª—è –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏—Ö —Å–æ–≤–µ—Ç–æ–≤.

üÜò –ï—Å–ª–∏ –Ω—É–∂–Ω–∞ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–∞—è –ø–æ–º–æ—â—å, –Ω–µ —Å—Ç–µ—Å–Ω—è–π—Ç–µ—Å—å –æ–±—Ä–∞—Ç–∏—Ç—å—Å—è –∫ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç—É.
"""
    elif any(word in text for word in ['—Å–ø–∞—Å–∏–±–æ', '–±–ª–∞–≥–æ–¥–∞—Ä—é', '–±–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç—å']):
        response = "üåü –ü–æ–∂–∞–ª—É–π—Å—Ç–∞! –Ø —Ä–∞–¥ –ø–æ–º–æ—á—å –≤–∞–º –Ω–∞ —ç—Ç–æ–º –ø—É—Ç–∏. –í—ã –¥–µ–ª–∞–µ—Ç–µ –≤–∞–∂–Ω—É—é —Ä–∞–±–æ—Ç—É! üí™"
    elif any(word in text for word in ['–∫–∞–∫ –¥–µ–ª–∞', '–ø—Ä–∏–≤–µ—Ç', '–∑–¥—Ä–∞–≤—Å—Ç–≤—É–π']):
        response = f"–ü—Ä–∏–≤–µ—Ç! üëã –ö–∞–∫ –≤–∞—à–∏ –¥–µ–ª–∞ —Å —Ç—Ä–µ–∑–≤–æ—Å—Ç—å—é? –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–≤–æ–π —Å—Ç–∞—Ç—É—Å –∫–æ–º–∞–Ω–¥–æ–π /status –∏–ª–∏ –ø–æ–ª—É—á–∏—Ç–µ –º–æ—Ç–∏–≤–∞—Ü–∏—é - /motivation"
    else:
        response = """
üí¨ –°–ø–∞—Å–∏–±–æ –∑–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ! 

–Ø –∑–¥–µ—Å—å, —á—Ç–æ–±—ã –ø–æ–¥–¥–µ—Ä–∂–∞—Ç—å –≤–∞—Å –Ω–∞ –ø—É—Ç–∏ –∫ —Ç—Ä–µ–∑–≤–æ—Å—Ç–∏. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ:
‚Ä¢ /status - —É–∑–Ω–∞—Ç—å —Å–≤–æ–π –ø—Ä–æ–≥—Ä–µ—Å—Å
‚Ä¢ /motivation - –ø–æ–ª—É—á–∏—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É
‚Ä¢ /tips - –ø–æ–ª–µ–∑–Ω—ã–µ —Å–æ–≤–µ—Ç—ã
‚Ä¢ /help - –≤—Å–µ –∫–æ–º–∞–Ω–¥—ã

üí™ –ü–æ–º–Ω–∏—Ç–µ: –∫–∞–∂–¥—ã–π –¥–µ–Ω—å —Ç—Ä–µ–∑–≤–æ—Å—Ç–∏ - —ç—Ç–æ –ø–æ–±–µ–¥–∞!
"""
    
    bot.send_message(message.chat.id, response)

if __name__ == '__main__':
    print("ü§ñ –ë–æ—Ç –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ —Ç—Ä–µ–∑–≤–æ—Å—Ç–∏ –∑–∞–ø—É—â–µ–Ω...")
    
    # –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ
    load_user_data()
    
    # –ó–∞–ø—É—Å–∫–∞–µ–º –±–æ—Ç–∞
    try:
        bot.infinity_polling(none_stop=True, interval=0, timeout=20)
    except Exception as e:
        print(f"–û—à–∏–±–∫–∞: {e}")
        # –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏
        save_user_data()
